<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>RDR2 — Повозки</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body { margin:0; }
    #map { height:100vh; background:#000; }

    /* Карточка (попап) */
    .card {
      width: 360px;
      border-radius: 18px;
      overflow: hidden;
      background: rgba(40, 28, 16, 0.92);
      color: #f4e7cf;
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    .cardTop { position: relative; height: 200px; background: #1b130b; }
    .cardImg { width: 100%; height: 100%; object-fit: cover; display:block; }

    .cardNavBtn {
      position:absolute; top: 50%; transform: translateY(-50%);
      width: 42px; height: 42px; border-radius: 50%;
      border: 0; cursor: pointer;
      background: rgba(0,0,0,.35); color: #fff;
      font-size: 22px; line-height: 42px;
    }
    .cardNavBtn:hover { background: rgba(0,0,0,.55); }
    .leftBtn { left: 10px; }
    .rightBtn { right: 10px; }

    .cardBody { padding: 14px 14px 16px; }
    .titleRow { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .cardTitle { font-size: 18px; font-weight: 800; }
    .badge {
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      padding: 6px 10px; border-radius: 999px;
      font-weight: 700; font-size: 12px; color: #ffe9b9;
      white-space: nowrap;
    }
    .metaRow { margin-top: 10px; display:flex; gap:10px; flex-wrap:wrap; }
    .pill {
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      padding: 8px 10px; border-radius: 12px;
      font-size: 13px;
    }
    .pill b { color:#ffd67a; }
    .desc { margin-top: 10px; opacity: .9; font-size: 13px; line-height: 1.35; }

    /* Стилі Leaflet popup */
    .leaflet-popup-content-wrapper { background: transparent; box-shadow:none; }
    .leaflet-popup-content { margin: 0; }
    .leaflet-popup-tip { background: rgba(40,28,16,.92); }
  </style>
</head>
<body>
<div id="map"></div>

<script>
  // ====== A) РОЗМІР ТВОЄЇ КАРТИНКИ map.jpg ======
  // Впиши реальний розмір map.jpg (ширина і висота)
  const MAP_WIDTH  = 3840;  // <-- ЗМІНИ, якщо інше
  const MAP_HEIGHT = 2160;  // <-- ЗМІНИ, якщо інше

  // ====== B) КАРТА (одна картинка, CRS.Simple) ======
  const map = L.map('map', { crs: L.CRS.Simple, minZoom: -2, maxZoom: 2 });

  // Межі: [y,x] тобто [[верх,ліворуч],[низ,праворуч]]
  const bounds = [[0,0],[MAP_HEIGHT, MAP_WIDTH]];

  // Фонова картинка з репозиторію
  L.imageOverlay('map.jpg', bounds).addTo(map);
  map.fitBounds(bounds);
  map.setMaxBounds(bounds);

  // ====== C) ІКОНКА ПОВОЗКИ (твоя) ======
  const wagonIcon = L.icon({
    iconUrl: 'images/wagon.png',
    iconSize: [48, 32],
    iconAnchor: [24, 32],
    popupAnchor: [0, -28]
  });

  // ====== D) ДАНІ (JSON) — тут ти додаєш повозки ======
  // lat = Y, lng = X (бо це картинка, не GPS)
  const wagons = [
    {
      id: 1,
      title: "Повозка #1",
      price: 100,
      lat: 900,   // Y
      lng: 2000,  // X
      photos: ["images/w1.jpg", "images/w2.jpg"],
      note: "Опис (за бажанням)."
    },
    {
      id: 2,
      title: "Повозка #2",
      price: 250,
      lat: 1100,
      lng: 2400,
      photos: ["images/w1.jpg"],
      note: "Ще одна точка."
    }
  ];

  // ====== E) HTML карточки ======
  function cardHtml(w) {
    const photos = (w.photos && w.photos.length) ? w.photos : ["images/w1.jpg"];
    return `
      <div class="card" data-idx="0" data-photos='${JSON.stringify(photos)}'>
        <div class="cardTop">
          <img class="cardImg" src="${photos[0]}" alt="photo">
          ${photos.length > 1 ? `<button class="cardNavBtn leftBtn" data-dir="-1">‹</button>` : ``}
          ${photos.length > 1 ? `<button class="cardNavBtn rightBtn" data-dir="1">›</button>` : ``}
        </div>

        <div class="cardBody">
          <div class="titleRow">
            <div class="cardTitle">${w.title}</div>
            <div class="badge">#${w.id}</div>
          </div>

          <div class="metaRow">
            <div class="pill"><b>Ціна:</b> ${w.price}$</div>
            <div class="pill"><b>X:</b> ${Math.round(w.lng)}</div>
            <div class="pill"><b>Y:</b> ${Math.round(w.lat)}</div>
          </div>

          <div class="desc">${w.note || ""}</div>
        </div>
      </div>
    `;
  }

  // ====== F) Додаємо маркери ======
  wagons.forEach(w => {
    L.marker([w.lat, w.lng], { icon: wagonIcon })
      .addTo(map)
      .on('click', () => {
        L.popup({ closeButton: true, maxWidth: 420 })
          .setLatLng([w.lat, w.lng])
          .setContent(cardHtml(w))
          .openOn(map);

        setTimeout(bindCardControls, 0);
      });
  });

  // ====== G) Перемикання фото в карточці ======
  function bindCardControls() {
    document.querySelectorAll('.cardNavBtn').forEach(btn => {
      btn.onclick = () => {
        const dir = parseInt(btn.getAttribute('data-dir'), 10);
        const card = btn.closest('.card');
        const photos = JSON.parse(card.getAttribute('data-photos'));
        let idx = parseInt(card.getAttribute('data-idx'), 10);

        idx = (idx + dir + photos.length) % photos.length;
        card.setAttribute('data-idx', String(idx));
        card.querySelector('.cardImg').src = photos[idx];
      };
    });
  }

  // ====== H) Клік по карті — показує координати для нових точок ======
  map.on('click', (e) => {
    alert(`Y(lat): ${Math.round(e.latlng.lat)}, X(lng): ${Math.round(e.latlng.lng)}`);
  });
</script>

</body>
</html>
